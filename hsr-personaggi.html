<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Honkai: Star Rail — Characters</title>
<link rel="stylesheet" href="assets/style.css?v=20250809">
<script defer src="assets/filters.js?v=20250809"></script>
</head>
<body>
<header class="site-header">
  <div></div>
  <a class="logo-wrap" href="index.html" title="Back to Home"><img class="site-logo" src="assets/logo.png" alt="Bolle Gacha Logo"></a>
  <div></div>
</header>

<main class="container">
  <h1>Honkai: Star Rail — Characters</h1>

  <!-- FILTRI (Path in id="weapon", per compatibilità con filters.js) -->
  <div class="filters">
    <div class="filter-box"><label>Search<br><input id="q" type="search" placeholder="Search name..."></label></div>
    <div class="filter-box"><label>Rarity<br>
      <select id="rarity">
        <option value="">All</option>
        <option value="5">5★</option>
        <option value="4">4★</option>
      </select></label></div>
    <div class="filter-box"><label>Path<br>
      <select id="weapon">
        <option value="">All</option>
        <option>Destruction</option>
        <option>Hunt</option>
        <option>Erudition</option>
        <option>Harmony</option>
        <option>Nihility</option>
        <option>Preservation</option>
        <option>Abundance</option>
        <option>Remembrance</option>
      </select></label></div>
    <div class="filter-box"><label>Element<br>
      <select id="element">
        <option value="">All</option>
        <option>Physical</option><option>Fire</option><option>Ice</option>
        <option>Lightning</option><option>Wind</option><option>Quantum</option><option>Imaginary</option>
      </select></label></div>
  </div>

  <!-- GRIGLIA VUOTA: verrà popolata da JS -->
  <div class="characters-grid" id="grid"></div>
</main>

<script>
  // Rimuove eventuali card hardcodate (se per sbaglio restano nello storico)
  document.addEventListener('DOMContentLoaded', ()=>{
    document.querySelectorAll('.characters-grid .char-card').forEach(el=>el.remove());

    // Carica roster HSR e genera le card
    fetch('assets/hsr_roster.json?v=20250809')
      .then(r=>r.json())
      .then(list=>{
        const wrap = document.getElementById('grid');
        wrap.innerHTML = list.map(c => `
          <a class="char-card" href="${c.link}"
             data-name="${c.name||''}"
             data-rarity="${c.rarity||''}"
             data-weapon="${c.path||c.weapon||''}"
             data-element="${c.element||''}">
            <div class="char-top">
              <div class="char-name">${c.name||''}</div>
              <div class="meta">
                ${c.element?`<span class="badge">${c.element}</span>`:''}
                ${(c.path||c.weapon)?`<span class="badge">${c.path||c.weapon}</span>`:''}
                ${c.rarity?`<span class="badge">${c.rarity}★</span>`:''}
              </div>
            </div>
          </a>
        `).join('');
        if (window.filterCharacters) window.filterCharacters();
      })
      .catch(e=>{
        console.error(e);
        document.getElementById('grid').innerHTML = '<div class="panel">Errore caricamento roster HSR.</div>';
      });
  });
</script>
<script>
  // --- HSR ENRICHER: compila Path/Element mancanti ---
  const HSR_PATH = {
    // Top & comuni — aggiungi liberamente!
    "Seele":"Hunt","Dan Heng":"Hunt","Dan Heng - Imbibitor Lunae":"Destruction",
    "Jingliu":"Destruction","Blade":"Destruction","Acheron":"Nihility","Kafka":"Nihility",
    "Black Swan":"Nihility","Ruan Mei":"Harmony","Bronya":"Harmony","Sparkle":"Harmony",
    "Gepard":"Preservation","Fu Xuan":"Preservation","Natasha":"Abundance","Bailu":"Abundance",
    "Welt":"Nihility","Silver Wolf":"Nihility","Topaz and Numby":"Hunt","Jing Yuan":"Erudition",
    "Himeko":"Erudition","Qingque":"Erudition","Arlan":"Destruction","Clara":"Destruction",
    "Sushang":"Hunt","Tingyun":"Harmony","Pela":"Nihility","Yukong":"Harmony",
    "Huohuo":"Abundance","Yanqing":"Hunt","Aventurine":"Preservation","Robin":"Harmony",
    "Firefly":"Destruction","Dr. Ratio":"Hunt","Luocha":"Abundance","Jiaoqiu":"Nihility",
    // Trailblazer (usa i tuoi slug):
    "Trailblazer (Physical)":"Destruction","Trailblazer (Fire)":"Preservation",
    "Trailblazer (Imaginary)":"Harmony","Trailblazer (Ice)":"Hunt"
  };
  const HSR_ELEM = {
    "Seele":"Quantum","Silver Wolf":"Quantum","Fu Xuan":"Quantum","Qingque":"Quantum",
    "Jingliu":"Ice","Gepard":"Ice","Herta":"Ice","Pela":"Ice","Yanqing":"Ice","Misha":"Ice",
    "Kafka":"Lightning","Serval":"Lightning","Bailu":"Lightning","Jing Yuan":"Lightning",
    "Acheron":"Lightning","Hook":"Fire","Topaz and Numby":"Fire","Himeko":"Fire","Guinaifen":"Fire",
    "Clara":"Physical","Sushang":"Physical","Luka":"Physical","Xueyi":"Quantum?","Arlan":"Lightning",
    "Bronya":"Wind","Dan Heng":"Wind","Blade":"Wind","Luocha":"Imaginary","Welt":"Imaginary",
    "Dr. Ratio":"Imaginary","Ruan Mei":"Ice","Sparkle":"Quantum","Aventurine":"Imaginary",
    "Robin":"Physical","Firefly":"Fire","Jiaoqiu":"Fire"
  };
  function enrichHSR(list){
    return list.map(c=>{
      const name=c.name||"";
      const filled = { ...c };
      if(!filled.path && HSR_PATH[name]) filled.path = HSR_PATH[name];
      if(!filled.element && HSR_ELEM[name]) filled.element = HSR_ELEM[name];
      return filled;
    });
  }

  // Sostituisci il fetch esistente (o inserisci se non c’è)
  document.addEventListener('DOMContentLoaded', ()=>{
    const wrap = document.getElementById('grid');
    fetch('assets/hsr_roster.json?v=20250809')
      .then(r=>r.json())
      .then(raw=>{
        const list = enrichHSR(raw);
        wrap.innerHTML = list.map(c => `
          <a class="char-card" href="${c.link}"
             data-name="${c.name||''}"
             data-rarity="${c.rarity||''}"
             data-weapon="${c.path||''}"
             data-element="${c.element||''}">
            <div class="char-top">
              <div class="char-name">${c.name||''}</div>
              <div class="meta">
                ${c.element?`<span class="badge">${c.element}</span>`:''}
                ${c.path?`<span class="badge">${c.path}</span>`:''}
                ${c.rarity?`<span class="badge">${c.rarity}★</span>`:''}
              </div>
            </div>
          </a>
        `).join('');
        if (window.filterCharacters) window.filterCharacters();
      })
      .catch(e=>{ console.error(e); wrap.innerHTML='<div class="panel">Errore caricamento roster HSR.</div>'; });
  });
</script>
</body>
</html>
